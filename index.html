<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¯€èƒ½å®ˆè­·è€…â€”ç ´è§£èƒ½æºå¯†ç¢¼</title>
    <!-- è¼‰å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- è¼‰å…¥ Google Font: Noto Sans TC -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        /* è¨­å®šå…¨åŸŸå­—é«”å’ŒèƒŒæ™¯ */
        body {
            font-family: 'Noto Sans TC', sans-serif;
            /* èƒ½æº/ç¯€èƒ½çš„è—ç¶ è‰²èª¿ */
            background: linear-gradient(135deg, #e0f7fa 0%, #b2ebf2 100%); 
            display: flex;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        /* ä¸»éŠæˆ²å®¹å™¨æ¨£å¼ */
        #app {
            width: 100%;
            max-width: 600px; 
            background-color: white;
            border-radius: 1.5rem; 
            box-shadow: 0 20px 40px -5px rgba(0, 0, 0, 0.2), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            padding: 1.5rem;
            min-height: 600px;
            display: flex;
            flex-direction: column;
        }
        /* æŒ‰éˆ• active æ•ˆæœ */
        button:active {
            transform: scale(0.98);
        }
    </style>
</head>
<body>

    <div id="app">
        <div class="text-center py-8 text-gray-500">è¼‰å…¥ä¸­...</div>
    </div>

    <script>
        // è¨­è¨ˆè€…ï¼šä½•è‰èŠ³zfang 2024.12
        
        // --- å…¨åŸŸè®Šæ•¸èˆ‡éŠæˆ²è¨­å®š ---

        const GameState = {
            COVER: 'COVER',     // çµ±ä¸€è™•ç†å°é¢å’Œèªªæ˜é  (å…± 3 æ­¥)
            MENU: 'MENU',
            LEVEL: 'LEVEL',
            FINISHED: 'FINISHED',
        };

        let state = {
            gameState: GameState.COVER, 
            coverStep: 1,               
            selectedLevelIndex: -1,     
            startTime: null,
            timerInterval: null,
            elapsedTime: 0,
            feedbackMessage: '',
            hintVisible: false,
            answerInput: '', 
            levelsStatus: Array(6).fill(false), 
            levelAttempts: Array(6).fill(0),    // è¿½è¹¤æ¯å€‹é—œå¡çš„éŒ¯èª¤å˜—è©¦æ¬¡æ•¸
        };

        // --- åœ–ç‰‡é€£çµè¨­å®š (å·²è½‰æ›ç‚º GitHub Raw é€£çµ) ---
        const BASE_URL = "https://raw.githubusercontent.com/zfangzfang/teachpic/main/";
        const COVER_IMAGE_URL = BASE_URL + "2.jpg"; 
        const INSTRUCTION_IMAGE_URL = BASE_URL + "3.jpg"; 
        const SUCCESS_IMAGE_URL = BASE_URL + "17.jpg"; 
        
        // --- é—œå¡è³‡æ–™è¨­å®š ---
        const LEVELS_DATA = [
            // Level 1: ç¥ç§˜èº«åˆ†ç·¨è™Ÿ
            {
                title: "é—œå¡ 1ï¼šç¥ç§˜èº«åˆ†ç·¨è™Ÿ",
                image: BASE_URL + "6.jpg", 
                hint: BASE_URL + "7.jpg", 
                answer: "é›»è™Ÿ774", 
                feedback: "å¤ªæ£’äº†ï¼æ‚¨æˆåŠŸè§£é–äº†é›»åŠ›ç·¨è™Ÿï¼",
            },
            // Level 2: å®ˆè­·è€…è¯ç›Ÿæš—è™Ÿ
            {
                title: "é—œå¡ 2ï¼šå®ˆè­·è€…è¯ç›Ÿæš—è™Ÿ",
                image: BASE_URL + "8.jpg",
                hint: BASE_URL + "8a.jpg",
                answer: "è¼ªæµåœé›»çµ„åˆ¥ï¼£", // ç­”æ¡ˆä¸­çš„ï¼£ç‚ºå…¨å½¢ (å·²åœ¨ checkAnswer å‡½æ•¸ä¸­è™•ç†ç›¸å®¹æ€§)
                feedback: "æ­å–œï¼æ‚¨æ‰¾åˆ°äº†å®ˆè­·è€…ä¹‹é–“çš„ç§˜å¯†è¯çµ¡ä»£è™Ÿã€‚",
            },
            // Level 3: ç’°ä¿å½±éŸ¿å€¼
            {
                title: "é—œå¡ 3ï¼šç’°ä¿å½±éŸ¿å€¼",
                image: BASE_URL + "9.jpg",
                hint: BASE_URL + "10.jpg",
                answer: "é›»åŠ›æ’ç¢³é‡820å…¬æ–¤", 
                feedback: "å®Œç¾ï¼æ‚¨è¨ˆç®—å‡ºäº†ç’°å¢ƒå½±éŸ¿çš„é—œéµæ•¸å€¼ã€‚",
            },
            // Level 4: ä»–ä¾†äº†ä»–åˆèµ°äº†
            {
                title: "é—œå¡ 4ï¼šä»–ä¾†äº†ä»–åˆèµ°äº†",
                image: BASE_URL + "11.jpg",
                hint: BASE_URL + "12.jpg",
                answer: "æŠ„è¡¨æ—¥1130827", 
                feedback: "æ‰¾åˆ°äº†ï¼æ‚¨è¿½è¹¤åˆ°äº†ç²¾ç¢ºçš„æŠ„è¡¨æ—¥æœŸã€‚",
            },
            // Level 5: è¿½è¹¤é›»åŠ›å¿è€…
            {
                title: "é—œå¡ 5ï¼šè¿½è¹¤é›»åŠ›å¿è€…",
                image: BASE_URL + "13.jpg",
                hint: BASE_URL + "14.jpg",
                // ç­”æ¡ˆåŒ…å«è‹±æ–‡ KWH (å·²åœ¨ checkAnswer å‡½æ•¸ä¸­è™•ç†ä¸åˆ†å¤§å°å¯«å’Œå…¨å½¢åŠå½¢)
                answer: "1659åº¦KWH", 
                feedback: "æˆåŠŸï¼æ‚¨æŒæ¡äº†èƒ½æºçš„ç§»å‹•è»Œè·¡ã€‚",
            },
            // Level 6: ç™¼ç¾å°ç¢ºå¹¸
            {
                title: "é—œå¡ 6ï¼šç™¼ç¾å°ç¢ºå¹¸",
                image: BASE_URL + "15.jpg",
                hint: BASE_URL + "16.jpg",
                answer: "ç¯€é›»çå‹µ0å…ƒ", 
                feedback: "å¤§æˆåŠŸï¼æ‚¨æ­é–‹äº†éš±è—çš„ç¯€èƒ½å°ç¢ºå¹¸ï¼",
            },
        ];

        // --- å­—å…ƒè™•ç†å‡½æ•¸ï¼šå°‡å…¨å½¢è½‰ç‚ºåŠå½¢ ---
        /**
         * å°‡å­—ä¸²ä¸­çš„å…¨å½¢ (Full-width) è‹±æ–‡å­—æ¯å’Œæ•¸å­—è½‰æ›ç‚ºåŠå½¢ (Half-width)ã€‚
         * é€™æ˜¯ç‚ºäº†è§£æ±ºæ‰‹æ©Ÿè¼¸å…¥æ™‚ï¼Œå…¨å½¢å’ŒåŠå½¢å­—å…ƒæ¯”å°å¤±æ•—çš„å•é¡Œã€‚
         */
        function toHalfWidth(str) {
            // åŒ¹é…å…¨å½¢å­—æ¯ï¼ˆï¼¡-ï¼º, ï½-ï½šï¼‰å’Œæ•¸å­—ï¼ˆï¼-ï¼™ï¼‰
            return str.replace(/[ï¼¡-ï¼ºï½-ï½šï¼-ï¼™]/g, function(s) {
                // å…¨å½¢èˆ‡åŠå½¢ä¹‹é–“æœ‰å›ºå®šçš„ Unicode åç§»é‡ 0xFEE0
                return String.fromCharCode(s.charCodeAt(0) - 0xFEE0);
            });
        }


        // --- è¨ˆæ™‚å™¨é‚è¼¯ ---

        function startTimer() {
            if (!state.startTime) { 
                state.startTime = Date.now();
                state.timerInterval = setInterval(updateTimerDisplay, 1000);
            }
        }

        function stopTimer() {
            if (state.timerInterval) {
                clearInterval(state.timerInterval);
                state.timerInterval = null;
            }
            state.elapsedTime = Date.now() - state.startTime;
        }

        function updateTimerDisplay() {
            const currentTime = Date.now();
            state.elapsedTime = currentTime - state.startTime;
            const timeElement = document.getElementById('timer-display');
            if (timeElement) {
                timeElement.textContent = formatTime(state.elapsedTime);
            }
        }

        function formatTime(ms) {
            const totalSeconds = Math.floor(ms / 1000);
            const hours = String(Math.floor(totalSeconds / 3600)).padStart(2, '0');
            const minutes = String(Math.floor((totalSeconds % 3600) / 60)).padStart(2, '0');
            const seconds = String(totalSeconds % 60).padStart(2, '0');
            return `${hours}:${minutes}:${seconds}`;
        }

        // --- éŠæˆ²é‚è¼¯èˆ‡æµç¨‹æ§åˆ¶ ---

        /** å°èˆªè‡³ç›®æ¨™ç‹€æ…‹ï¼ŒåŒæ™‚æª¢æŸ¥æ˜¯å¦å®Œæˆæ‰€æœ‰é—œå¡ */
        function navigate(targetState) {
            state.feedbackMessage = '';
            state.hintVisible = false;
            state.answerInput = '';

            if (targetState === GameState.MENU) {
                const completedCount = state.levelsStatus.filter(status => status).length;
                if (completedCount === LEVELS_DATA.length) {
                    stopTimer();
                    state.gameState = GameState.FINISHED;
                } else {
                    state.gameState = targetState; 
                    startTimer(); 
                }
            } else {
                 state.gameState = targetState;
            }
            render();
        }

        /** å°é¢é /èªªæ˜é çš„ä¸‹ä¸€é æŒ‰éˆ•é‚è¼¯ */
        function nextScreen() {
            if (state.gameState === GameState.COVER) {
                if (state.coverStep < 3) {
                    state.coverStep++; 
                    render();
                } else {
                    // å®Œæˆä¸‰é èªªæ˜å¾Œï¼Œé€²å…¥ä¸»é¸å–®
                    navigate(GameState.MENU);
                }
            }
        }


        /** é¸æ“‡é—œå¡ */
        function selectLevel(index) {
            state.selectedLevelIndex = index;
            state.gameState = GameState.LEVEL;
            // æ¯æ¬¡é€²å…¥é—œå¡ï¼Œæª¢æŸ¥æ˜¯å¦å·²é”éŒ¯èª¤æ¬¡æ•¸ï¼Œæ±ºå®šæ˜¯å¦é¡¯ç¤ºæç¤ºæŒ‰éˆ•
            state.hintVisible = false; 
            render();
        }

        /** æª¢æŸ¥ç­”æ¡ˆ */
        function checkAnswer() {
            const levelIndex = state.selectedLevelIndex;
            const currentData = LEVELS_DATA[levelIndex];

            if (state.levelsStatus[levelIndex]) {
                 state.feedbackMessage = 'âœ… æœ¬é—œå·²å®Œæˆï¼Œç„¡éœ€é‡è¤‡æäº¤ï¼';
                 render();
                 return;
            }

            if (!state.answerInput.trim()) {
                state.feedbackMessage = 'âŒ è«‹å…ˆè¼¸å…¥ç­”æ¡ˆï¼';
                render();
                return;
            }

            // --- ç­”æ¡ˆæ¸…ç†èˆ‡æ¨™æº–åŒ– (è™•ç†å…¨å½¢ã€åŠå½¢ã€å¤§å°å¯«å’Œç©ºæ ¼) ---
            
            // 1. è™•ç†ä½¿ç”¨è€…è¼¸å…¥ï¼šè½‰æ›å…¨å½¢ç‚ºåŠå½¢ã€ç§»é™¤æ‹¬è™Ÿã€è½‰å°å¯«ã€ç§»é™¤æ‰€æœ‰ç©ºæ ¼
            const cleanInput = toHalfWidth(state.answerInput.trim())
                               .replace(/[()ï¼ˆï¼‰]/g, '') // ç§»é™¤ä¸­æ–‡å’Œè‹±æ–‡æ‹¬è™Ÿ
                               .toLowerCase()           // è½‰å°å¯« (è™•ç† KWH ç­‰å¤§å°å¯«å•é¡Œ)
                               .replace(/ /g, '');       // ç§»é™¤å…§éƒ¨ç©ºæ ¼
            
            // 2. è™•ç†æ¨™æº–ç­”æ¡ˆ (ä½¿ç”¨ç›¸åŒæ¨™æº–åŒ–é‚è¼¯)
            const cleanAnswer = toHalfWidth(currentData.answer.trim())
                                .replace(/[()ï¼ˆï¼‰]/g, '')
                                .toLowerCase()
                                .replace(/ /g, '');

            // ç­”æ¡ˆæ ¸å°
            if (cleanInput === cleanAnswer) {
                state.feedbackMessage = `âœ… æ­å–œéé—œï¼${currentData.feedback}`;
                state.levelsStatus[levelIndex] = true; 
                state.levelAttempts[levelIndex] = 0; 
                
                setTimeout(() => {
                    navigate(GameState.MENU);
                }, 1500); 

            } else {
                // éŒ¯èª¤é‚è¼¯ï¼šå¢åŠ å˜—è©¦æ¬¡æ•¸
                state.levelAttempts[levelIndex]++;
                
                if (state.levelAttempts[levelIndex] >= 2) {
                    state.feedbackMessage = 'âŒ ç­”æ¡ˆéŒ¯èª¤ã€‚å·²ç´¯ç© 2 æ¬¡éŒ¯èª¤ï¼Œç¾åœ¨å¯é»æ“Šã€ŒæŸ¥çœ‹æç¤ºã€ï¼';
                } else {
                    state.feedbackMessage = `âŒ ç­”æ¡ˆéŒ¯èª¤ï¼Œè«‹é‡æ–°æ€è€ƒï¼ (ç¬¬ ${state.levelAttempts[levelIndex]} æ¬¡å˜—è©¦)`;
                }
                render();
            }
        }

        /** é¡¯ç¤ºæç¤º */
        function showHint() {
            const levelIndex = state.selectedLevelIndex;
            if (state.levelsStatus[levelIndex]) return; 
            if (state.levelAttempts[levelIndex] < 2) {
                 // ä¸æ‡‰è©²ç™¼ç”Ÿï¼Œä½†ä½œç‚ºé˜²è­·
                 state.feedbackMessage = 'è«‹è‡³å°‘éŒ¯èª¤ 2 æ¬¡æ‰èƒ½æŸ¥çœ‹æç¤ºï¼';
                 render();
                 return;
            }
            state.hintVisible = true;
            state.feedbackMessage = 'ğŸ’¡ æç¤ºå·²å‡ºç¾ï¼Œè«‹ä»”ç´°æŸ¥çœ‹ï¼';
            render();
        }

        /** è™•ç†è¼¸å…¥æ¡†è®ŠåŒ– */
        function handleInput(event) {
            state.answerInput = event.target.value;
        }
        
        /** è™•ç†åœ–ç‰‡è¼‰å…¥å¤±æ•—ï¼Œæä¾›ä¸€èˆ¬ä½”ä½åœ–ä½œç‚ºæœ€å¾Œçš„ä¿éšœ */
        function handleImageError(element) {
            element.onerror = null; 
            element.src = 'https://placehold.co/600x300/6b7280/fff?text=åœ–ç‰‡è¼‰å…¥å¤±æ•—';
            element.classList.add('border-4', 'border-gray-500');
        }

        // --- æ¸²æŸ“å‡½æ•¸ (HTML æ¨¡æ¿) ---
        
        /** æ¸²æŸ“å°é¢/èªªæ˜é é¢ (å…± 3 é ) */
        function renderCover() {
            let title = '';
            let content = '';
            let image = '';
            // å°‡ GO æ”¾åœ¨æœ€å¾Œä¸€æ­¥
            let buttonText = (state.coverStep < 3) ? 'é€²å…¥ä¸‹ä¸€é ' : "ğŸ”¥ GOï¼é€²å…¥ä¸»é¸å–® (é–‹å§‹è¨ˆæ™‚)"; 
            
            // æ ¹æ“š coverStep æ±ºå®šå…§å®¹
            switch (state.coverStep) {
                case 1:
                    title = "ç¯€èƒ½å®ˆè­·è€…â€”ç ´è§£èƒ½æºå¯†ç¢¼";
                    content = `<p class="text-xl font-bold text-teal-600 mb-4">è®€æ‡‚é›»è²»å–® 2.0 ç‰ˆ</p>
                               <p class="text-sm text-gray-500 mb-4">è¨­è¨ˆè€…ï¼šä½•è‰èŠ³zfang 2024.12</p>
                               <p class="text-lg text-gray-700">æ­¡è¿ä¾†åˆ°èƒ½æºçŸ¥è­˜çš„è©¦ç…‰ï¼æ‚¨æº–å‚™å¥½æˆç‚ºç¯€èƒ½å®ˆè­·è€…äº†å—ï¼Ÿ</p>`;
                    image = COVER_IMAGE_URL;
                    break;
                case 2:
                    title = "éŠæˆ²èªªæ˜èˆ‡è¦å‰‡";
                    content = `
                        <p class="text-lg text-gray-700 font-semibold mb-4">å…­å€‹é—œå¡å¯ä»¥ä¸æŒ‰ç…§é †åºæŒ‘æˆ°ã€‚</p>
                        <p class="text-red-500 font-bold mb-4">æ³¨æ„ï¼šå•é¡Œçš„ç­”æ¡ˆå¯èƒ½åŒ…å«ä¸­æ–‡èˆ‡æ•¸å­—ã€‚</p>
                        <ul class="list-disc list-inside text-left space-y-2 text-gray-700 ml-4">
                            <li>ç­”éŒ¯ <span class="text-indigo-600 font-bold">2 æ¬¡</span> å¾Œï¼Œå³å¯é»æ“ŠæŒ‰éˆ•æŸ¥çœ‹æç¤ºã€‚</li>
                            <li>ä»»å‹™å®Œæˆå¾Œï¼Œç¯€èƒ½å®ˆè­·çŸ³å°‡æ¢å¾©åŠ›é‡ï¼</li>
                        </ul>
                    `;
                    image = INSTRUCTION_IMAGE_URL; 
                    break;
                case 3:
                    title = "æº–å‚™å•Ÿå‹•ä»»å‹™";
                    content = '<p class="text-xl font-bold text-red-600">è¨ˆæ™‚å™¨å°‡åœ¨æ‚¨é»æ“Šã€ŒGOã€å‡ºç™¼å¾Œç«‹å³å•Ÿå‹•ï¼</p><p class="mt-2 text-gray-600">ç¥æ‚¨é †åˆ©å®Œæˆèƒ½æºå®ˆè­·è€…çš„è©¦ç…‰ï¼</p>';
                    image = COVER_IMAGE_URL; // ä¿æŒç¬¬ä¸€é åœ–ç‰‡æˆ–æ›¿æ›ç‚ºæ‚¨æº–å‚™çš„ç¬¬ä¸‰å¼µåœ–
                    break;
                default:
                    title = "ç™¼ç”Ÿæœªé æœŸçš„éŒ¯èª¤";
                    content = "<p>è«‹é‡æ–°è¼‰å…¥éŠæˆ²ã€‚</p>";
                    image = "https://placehold.co/600x300/ff0000/fff?text=éŒ¯èª¤";
            }
            
            return `
                <div class="flex-grow flex flex-col justify-center items-center p-4 text-center">
                    <h1 class="text-3xl font-extrabold text-gray-800 mb-6">${title}</h1>
                    <img src="${image}" alt="${title}" 
                         onerror="handleImageError(this)"
                         class="w-full h-auto object-cover rounded-xl shadow-lg mb-6">
                    <div class="text-lg mb-8">${content}</div>
                </div>
                <button onclick="nextScreen()" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-full transition duration-300 shadow-xl">
                    ${buttonText}
                </button>
            `;
        }

        /** æ¸²æŸ“ä¸»é¸å–®é é¢ (éš¨æ©Ÿé¸æ“‡é—œå¡) */
        function renderMenu() {
            const totalLevels = LEVELS_DATA.length;
            const completedCount = state.levelsStatus.filter(status => status).length;

            return `
                <div class="flex justify-between items-center mb-6 pb-2 border-b-4 border-teal-500">
                    <h1 class="text-3xl font-extrabold text-teal-700">ğŸ¯ å¯†ç¢¼æŒ‘æˆ°ä¸»é¸å–®</h1>
                    <div id="timer-display" class="text-xl font-mono text-red-600 bg-red-100 px-3 py-1 rounded-lg shadow-inner border border-red-300">
                        ${state.startTime ? formatTime(state.elapsedTime) : '00:00:00'}
                    </div>
                </div>
                
                <p class="text-lg font-semibold text-gray-600 mb-6">
                    å·²è§£é–ï¼š<span class="text-green-600 font-extrabold">${completedCount}</span> / ${totalLevels} é—œ
                </p>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 flex-grow overflow-y-auto">
                    ${LEVELS_DATA.map((level, index) => {
                        const isCompleted = state.levelsStatus[index];
                        const statusClass = isCompleted ? 'bg-green-500 hover:bg-green-600' : 'bg-indigo-500 hover:bg-indigo-600';
                        const icon = isCompleted ? 'âœ…' : 'ğŸ”’';

                        return `
                            <button onclick="selectLevel(${index})" 
                                class="${statusClass} text-white font-bold py-4 px-4 rounded-xl shadow-lg transition duration-300 text-left flex items-center justify-between transform hover:scale-[1.02]">
                                <div>
                                    <span class="text-xs font-light opacity-80">${isCompleted ? 'èƒ½æºæ¢å¾©' : 'ç­‰å¾…æŒ‘æˆ°'}</span>
                                    <p class="text-xl font-extrabold">${level.title}</p>
                                </div>
                                <span class="text-3xl ml-3">${icon}</span>
                            </button>
                        `;
                    }).join('')}
                </div>
            `;
        }

        /** æ¸²æŸ“é—œå¡é é¢ */
        function renderLevel() {
            const levelIndex = state.selectedLevelIndex;
            const currentData = LEVELS_DATA[levelIndex];
            const isCompleted = state.levelsStatus[levelIndex];

            // æ¸²æŸ“æç¤ºå€å¡Š
            const hintSection = state.hintVisible 
                ? `<div class="mt-4 p-4 bg-yellow-50 border-l-4 border-yellow-400 rounded-lg shadow-inner">
                    <p class="font-bold text-yellow-700 mb-2">ğŸ’¡ å®ˆè­·è€…æç¤ºï¼š</p>
                    <img src="${currentData.hint}" alt="Hint Image" 
                         onerror="handleImageError(this)"
                         class="w-full h-auto object-cover rounded-md">
                </div>` 
                : '';
                
            const completionMessage = isCompleted 
                ? `<div class="p-3 bg-green-100 text-green-700 font-bold rounded-lg mb-4 text-center">
                    âœ… å¯†ç¢¼å·²ç ´è§£ï¼ (ç­”æ¡ˆï¼š${currentData.answer})
                   </div>`
                : '';
            
            // æç¤ºæŒ‰éˆ•çš„é‚è¼¯ï¼šç­”éŒ¯ 2 æ¬¡æ‰èƒ½é»æ“Š
            const attempts = state.levelAttempts[levelIndex];
            const showHintButton = (() => {
                if (state.hintVisible) {
                    return `<button disabled class="w-full bg-yellow-400 text-yellow-900 font-bold py-3 rounded-full shadow-md">
                        ğŸ’¡ æç¤ºå·²é¡¯ç¤º
                    </button>`;
                } else if (isCompleted) {
                    return `<button disabled class="w-full bg-gray-200 text-gray-500 font-bold py-3 rounded-full">
                        âœ… æœ¬é—œå·²éï¼Œç„¡éœ€æç¤º
                    </button>`;
                } else if (attempts >= 2) {
                    return `<button onclick="showHint()" class="w-full bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 rounded-full shadow-lg transition duration-300">
                        ğŸ’¡ æŸ¥çœ‹æç¤º (å·²éŒ¯èª¤ ${attempts} æ¬¡)
                    </button>`;
                } else {
                    return `<button disabled class="w-full bg-gray-100 text-gray-500 font-bold py-3 rounded-full shadow-inner">
                        âŒ éŒ¯èª¤ ${2 - attempts} æ¬¡å¾Œå¯æŸ¥çœ‹æç¤º
                    </button>`;
                }
            })();


            return `
                <div class="flex flex-col flex-grow">
                    <div class="flex justify-between items-center mb-4 border-b-2 border-indigo-400 pb-2">
                        <h2 class="text-2xl font-extrabold text-indigo-700">${currentData.title}</h2>
                        <div id="timer-display" class="text-xl font-mono text-red-600 bg-red-100 px-3 py-1 rounded-lg shadow-inner border border-red-300">
                            ${formatTime(state.elapsedTime)}
                        </div>
                    </div>

                    <div class="flex-grow overflow-y-auto pb-4">
                        ${completionMessage}
                        <p class="text-gray-700 mb-4 font-semibold">è«‹è§€å¯Ÿåœ–ç‰‡ï¼Œæ‰¾å‡ºæ­£ç¢ºçš„èƒ½æºå¯†ç¢¼ï¼š</p>
                        <!-- é¡Œç›®åœ–ç‰‡å€å¡Š -->
                        <img src="${currentData.image}" alt="Puzzle Image" 
                            onerror="handleImageError(this)"
                            class="w-full h-auto object-cover rounded-xl shadow-2xl">

                        ${hintSection}

                        <!-- ç­”é¡Œèˆ‡å›é¥‹å€å¡Š -->
                        <div class="mt-6">
                            <div class="mt-4 h-10">
                                <p class="${state.feedbackMessage.startsWith('âœ…') ? 'text-green-600' : 'text-red-600'} font-semibold text-lg">
                                    ${state.feedbackMessage}
                                </p>
                            </div>
                            
                            <label for="answerInput" class="block text-sm font-medium text-gray-700 mb-2">è¼¸å…¥æ‚¨çš„å¯†ç¢¼</label>
                            <input type="text" id="answerInput" oninput="handleInput(event)" value="${state.answerInput}"
                                ${isCompleted ? 'disabled' : ''}
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-4 focus:ring-indigo-400 text-gray-900 disabled:bg-gray-100 disabled:text-gray-500 transition duration-150" 
                                placeholder="è«‹åœ¨é€™è£¡è¼¸å…¥å¯†ç¢¼...">
                        </div>
                    </div>
                </div>

                <!-- åº•éƒ¨æŒ‰éˆ•å€å¡Š -->
                <div class="mt-4 space-y-3">
                    ${!isCompleted ? 
                        `<button onclick="checkAnswer()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-full shadow-xl transition duration-300">
                            ğŸ”‘ æäº¤ç­”æ¡ˆ
                        </button>`
                        : ''
                    }
                    ${showHintButton}
                    <button onclick="navigate(GameState.MENU)" class="w-full bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 rounded-full shadow-lg transition duration-300">
                        ğŸ”™ è¿”å›ä¸»é¸å–®
                    </button>
                </div>
            `;
        }

        /** æ¸²æŸ“ Finished é é¢ (çµç®—) */
        function renderFinished() {
            const finalTime = formatTime(state.elapsedTime);
            return `
                <div class="flex-grow flex flex-col justify-center items-center p-4 text-center">
                    <div class="text-7xl mb-6">ğŸ†</div>
                    <h1 class="text-4xl font-extrabold text-green-600 mb-4">æ­å–œï¼æ‰€æœ‰å¯†ç¢¼ç ´è§£æˆåŠŸï¼</h1>
                    <p class="text-xl text-gray-700 mb-6">æ‚¨æˆåŠŸè§£é–äº†æ‰€æœ‰ 6 å€‹èƒ½æºå¯†ç¢¼ï¼Œç¯€èƒ½å®ˆè­·çŸ³æ¢å¾©äº†åŠ›é‡ï¼</p>
                    
                    <!-- æŒ‘æˆ°æˆåŠŸç•«é¢åœ–ç‰‡ -->
                    <img src="${SUCCESS_IMAGE_URL}" alt="Challenge Success Image" 
                         onerror="handleImageError(this)"
                         class="w-full max-w-sm h-auto object-cover rounded-xl shadow-2xl mb-8">

                    <div class="bg-white p-6 rounded-xl shadow-2xl border-4 border-green-500 w-full max-w-xs">
                        <p class="text-lg font-semibold text-gray-600 mb-2">æœ€çµ‚è€—æ™‚ï¼š</p>
                        <p class="text-5xl font-mono font-bold text-green-700">${finalTime}</p>
                    </div>

                    <button onclick="window.location.reload()" class="mt-10 bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-8 rounded-full transition duration-300 shadow-lg">
                        é‡æ–°é–‹å§‹éŠæˆ²
                    </button>
                </div>
            `;
        }

        /** ä¸»è¦æ¸²æŸ“å‡½æ•¸ */
        function render() {
            const app = document.getElementById('app');
            let content = '';

            switch (state.gameState) {
                case GameState.COVER:
                    content = renderCover();
                    break;
                case GameState.MENU:
                    content = renderMenu();
                    break;
                case GameState.LEVEL:
                    content = renderLevel();
                    break;
                case GameState.FINISHED:
                    content = renderFinished();
                    break;
                default:
                    content = '<div class="text-center py-8 text-red-500 font-bold">ç™¼ç”Ÿäº†æœªçŸ¥çš„ç‹€æ…‹éŒ¯èª¤ï¼è«‹é‡æ–°æ•´ç†ã€‚</div>';
            }

            app.innerHTML = content;

            // ç¢ºä¿æ¯æ¬¡é‡æ–°æ¸²æŸ“å¾Œï¼Œè¼¸å…¥æ¡†çš„å€¼å’Œäº‹ä»¶ç›£è½å™¨æ­£ç¢ºè¨­ç½®
            const inputElement = document.getElementById('answerInput');
            if (inputElement) {
                inputElement.value = state.answerInput;
                inputElement.addEventListener('input', handleInput);
            }
        }

        // --- å•Ÿå‹•éŠæˆ² ---
        window.onload = render;

    </script>
</body>
</html>
